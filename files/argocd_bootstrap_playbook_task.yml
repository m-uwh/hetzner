- name: Kubermetes Apps | Wait for condition ArgoCD Applicationset Controller
  ansible.builtin.shell:
    cmd: kubectl wait --for=condition=ready -n argocd pod -l  app.kubernetes.io/name=argocd-applicationset-controller --timeout=60s

- name: Kubernetes Apps | Bootstrap ArgoCD
  become: yes
  kube:
    name: ArgoCD Bootstrap
    kubectl: "{{ bin_dir }}/kubectl"
    filename: "{{ kube_config_dir }}/argocd-bootstrap.yml"
    state: latest
  when:
    - "inventory_hostname == groups['kube_control_plane'][0]" 